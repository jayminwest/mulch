{"type":"pattern","name":"init-artifacts","description":"mulch init creates .mulch/, config, .gitattributes (merge=union for JSONL), and .mulch/README.md â€” modeled after Beads' bd init pattern","classification":"foundational","recorded_at":"2026-02-10T00:33:16.583Z","files":["src/utils/config.ts"],"id":"mx-6e8404"}
{"type":"pattern","name":"git-hook-markers","description":"Git hooks use # mulch:start / # mulch:end markers for safe append/remove in .git/hooks/pre-commit, same marker pattern as HTML comments in AGENTS.md sections","classification":"tactical","recorded_at":"2026-02-10T00:33:18.159Z","files":["src/commands/setup.ts"],"id":"mx-a27124"}
{"type":"pattern","name":"record-dedup","description":"mulch record checks for duplicates before appending. Named types (pattern/decision) upsert by name/title. Unnamed types (convention/failure) skip on exact content/description match. --force overrides.","classification":"tactical","recorded_at":"2026-02-10T01:09:21.633Z","files":["src/commands/record.ts","src/utils/expertise.ts"],"id":"mx-d065b4"}
{"type":"guide","name":"add-command","description":"How to add a new CLI command: create src/commands/<name>.ts, export register<Name>Command, register in src/cli.ts","classification":"tactical","recorded_at":"2026-02-10T01:16:26.826Z","id":"mx-60f9f9"}
{"type":"pattern","name":"type-extensible-records","description":"Adding record types follows a checklist: (1) record.ts types, (2) record-schema.ts oneOf, (3) record.ts command switch, (4) edit.ts switch, (5) expertise.ts findDuplicate, (6) format.ts formatters (md/xml/plain), (7) search.ts choices. Named types (pattern/decision/reference/guide) upsert by name; unnamed (convention/failure) skip on exact match.","classification":"tactical","recorded_at":"2026-02-10T01:16:58.885Z","files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/commands/record.ts","src/utils/format.ts"],"id":"mx-65226a"}
{"type":"pattern","name":"tags-on-records","description":"Optional tags: string[] on all record types via BaseRecord. --tags flag on record (comma-separated), --tag filter on search (exact match, case-insensitive). searchRecords also searches array values via Array.isArray check.","classification":"tactical","recorded_at":"2026-02-10T01:26:13.157Z","files":["src/schemas/record.ts","src/commands/record.ts","src/commands/search.ts","src/utils/expertise.ts"],"id":"mx-6bdf1e"}
{"type":"pattern","name":"context-aware-prime","description":"mulch prime --context filters records by git changed files. Records without files field (conventions, failures, decisions, guides) always pass. Pattern/reference records filtered by file-path intersection using suffix matching. filterByContext and fileMatchesAny live in src/utils/git.ts as shared utilities.","classification":"tactical","recorded_at":"2026-02-10T18:51:23.100Z","files":["src/commands/prime.ts","src/utils/git.ts"],"id":"mx-004b07"}
{"type":"pattern","name":"record-linking","description":"relates_to and supersedes optional string[] fields on BaseRecord. Schema validates mx-ID pattern. formatLinks() helper renders in all prime formats (md, compact, xml, plain). Links shown even without --full flag.","classification":"foundational","recorded_at":"2026-02-10T18:58:45.777Z","files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/utils/format.ts"],"id":"mx-775d76"}
{"type":"pattern","name":"compact-command","description":"mulch compact --analyze finds candidates (3+ records of same type, or 2+ with stale records). --apply takes --records (IDs/indices), type-specific fields, removes source records, appends consolidated record with foundational classification and supersedes links.","classification":"foundational","recorded_at":"2026-02-10T18:58:51.077Z","files":["src/commands/compact.ts"],"id":"mx-d80a97"}
{"type":"pattern","name":"compact-default-prime","description":"mulch prime defaults to compact output. Use -v/--verbose for full output with section headers, rules, and recording instructions. --full shows expanded record details (classification, evidence, grouped sections). --format xml|plain bypass compact and use their own formatters.","classification":"tactical","recorded_at":"2026-02-10T19:01:26.869Z","files":["src/commands/prime.ts"],"id":"mx-0b1448"}
{"type":"pattern","name":"messaging-sync","description":"All user-facing messaging (onboard snippets, setup provider recipes, CLAUDE.md, README, CLI help text) uses unified template: 'At the start of every session', all 6 record types, context injection line, and mulch --help reference. Terminology standardized on 'records' not 'entries'.","classification":"foundational","recorded_at":"2026-02-10T22:18:25.982Z","files":["src/commands/onboard.ts","src/commands/setup.ts","CLAUDE.md","README.md"],"id":"mx-108581"}
{"type":"convention","content":"Use 'records' not 'entries' in all user-facing messages (command descriptions, output text, format headers). Config field names like max_entries and XML attributes are exempt.","classification":"foundational","recorded_at":"2026-02-10T22:18:31.326Z","id":"mx-e98196"}
{"type":"convention","content":"cli.ts .version() must match package.json version. Bump both together.","classification":"foundational","recorded_at":"2026-02-10T22:18:36.312Z","id":"mx-5ab2bc"}
{"type":"pattern","name":"session-end-prompting","description":"All agent-facing snippets (onboard, setup recipes, CLAUDE.md) use 'Before completing your task, review your work for insights' framing to prompt agents to record learnings as a gate before task completion â€” not a passive suggestion. The onboard snippet has a 'Before You Finish' checklist; provider recipes use a single-line instruction.","classification":"tactical","recorded_at":"2026-02-10T22:45:53.387Z","tags":["prompting","messaging"],"id":"mx-4d72e9"}
{"type":"decision","title":"ID-based record addressing","rationale":"Replaced 1-based index addressing with mx-ID prefix matching (like beads). edit/delete/compact all use resolveRecordId() from expertise.ts. IDs shown in all output formats (query, search, prime compact/full/xml/plain). Fixes mismatch where query type-groups display order differed from insertion-order indices.","classification":"tactical","recorded_at":"2026-02-10T22:51:16.659Z","id":"mx-4b9c8e"}
{"type":"pattern","name":"onboard-marker-update","description":"mulch onboard uses <!-- mulch:start --> / <!-- mulch:end --> markers for idempotent section replacement. resolveTargetFile checks CLAUDE.md, .claude/CLAUDE.md, AGENTS.md in order. Legacy (pre-marker) snippets detected by header and migrated. --check flag for read-only inspection.","classification":"foundational","recorded_at":"2026-02-11T23:36:02.028Z","tags":["onboard","markers"],"id":"mx-9ac899"}
{"type":"pattern","name":"shared-markers","description":"src/utils/markers.ts exports MARKER_START, MARKER_END, hasMarkerSection(), replaceMarkerSection(), removeMarkerSection(), wrapInMarkers(). Used by both onboard.ts and setup.ts for HTML comment marker management in markdown files.","classification":"foundational","recorded_at":"2026-02-11T23:36:07.312Z","tags":["markers","utilities"],"id":"mx-5e6801"}
{"type":"pattern","name":"update-version-check","description":"mulch update uses npm view mulch-cli version via execSync (10s timeout) to check registry. compareSemver in src/utils/version.ts does 3-segment numeric comparison. Doctor integrates as last check (warn status, not fail). --check flag for dry run.","classification":"foundational","recorded_at":"2026-02-11T23:43:28.095Z","files":["src/utils/version.ts","src/commands/update.ts","src/commands/doctor.ts"],"id":"mx-052895"}
{"type":"failure","description":"CI workflows ran npm test before npm run build, but update.test.ts shells out to node dist/cli.js which requires built output.","resolution":"Move npm run build before npm test in both CI and publish workflows","classification":"tactical","recorded_at":"2026-02-11T23:47:30.530Z","id":"mx-c69b29"}
{"type":"pattern","name":"atomic-writes","description":"writeExpertiseFile uses temp file + rename for atomic JSONL writes: write to ${filePath}.tmp.${process.pid}, then fs.rename to final path. Prevents partial reads during concurrent prime calls.","classification":"foundational","recorded_at":"2026-02-12T15:44:51.818Z","files":["src/utils/expertise.ts"],"id":"mx-cb17e6"}
{"type":"pattern","name":"file-locking","description":"withFileLock(filePath, fn) in src/utils/lock.ts provides advisory file-level locking using O_CREAT|O_EXCL .lock files. 50ms retry interval, 5s timeout, 30s stale detection. All read-modify-write command paths wrapped.","classification":"foundational","recorded_at":"2026-02-12T15:44:55.425Z","files":["src/utils/lock.ts","src/commands/record.ts","src/commands/edit.ts","src/commands/delete.ts","src/commands/compact.ts","src/commands/prune.ts","src/commands/doctor.ts"],"id":"mx-3b9cd5"}
{"type":"pattern","name":"concurrency-docs","description":"Concurrency safety documentation lives in three places that must stay in sync: (1) README.md 'Concurrency & Multi-Agent Safety' section with command safety table, (2) CLAUDE.md 'Concurrency Safety' subsection under Architecture, (3) onboard snippet in src/commands/onboard.ts SNIPPET_DEFAULT.","classification":"foundational","recorded_at":"2026-02-12T15:52:42.179Z","evidence":{"file":"src/commands/onboard.ts"},"tags":["concurrency","docs"],"id":"mx-1a8c90"}
{"type":"convention","content":"When documenting command safety for multi-agent use, categorize commands into three tiers: fully safe (read-only), safe (locked writes), and serialize (setup ops). This matches the actual locking architecture.","classification":"foundational","recorded_at":"2026-02-12T15:52:45.429Z","tags":["concurrency"],"id":"mx-fd3cee"}
{"type":"convention","content":"Maintain CHANGELOG.md (Keep a Changelog format) in repo root. Add entries under [Unreleased] as changes are made. When bumping version, move [Unreleased] items into a new version section with date, and add a compare link to the footer.","classification":"tactical","recorded_at":"2026-02-12T16:12:42.016Z","id":"mx-900a53"}
{"type":"convention","content":"Keep README.md in sync with project state. When features are added, changed, or removed, update the relevant README sections (command reference, usage examples, feature descriptions) in the same commit or PR.","classification":"tactical","recorded_at":"2026-02-12T16:13:46.771Z","id":"mx-6ac234"}
{"type":"pattern","name":"prime-budget","description":"mulch prime uses --budget <tokens> (default 4000, chars/4 estimate) to cap output. Records prioritized by type (convention>decision>pattern>guide>failure>reference), then classification (foundational>tactical>observational), then recency. Budget logic lives in src/utils/budget.ts. --no-limit disables. MCP/JSON output is never budgeted.","classification":"tactical","recorded_at":"2026-02-12T17:00:37.012Z","files":["src/utils/budget.ts","src/commands/prime.ts"],"id":"mx-89c8cd"}
{"type":"pattern","name":"prime-session-reminder","description":"mulch prime appends a Session Close Protocol section (with ðŸš¨ markers) to all non-MCP/JSON output. getSessionEndReminder(format) in src/utils/format.ts returns format-appropriate text (markdown, xml, plain). Reminder is always shown regardless of budget.","classification":"tactical","recorded_at":"2026-02-12T17:00:39.043Z","files":["src/utils/format.ts","src/commands/prime.ts"],"id":"mx-f97cd4"}
{"type":"failure","description":"Merged external PR then added tests in a separate commit without co-authoring the contributor. Can't push to fork branches, so either ask the contributor to add tests before merging, or co-author the follow-up commit.","resolution":"When adding follow-up commits for external PRs, always Co-Authored-By the original contributor. Better yet, request changes on the PR so they can add tests themselves.","classification":"tactical","recorded_at":"2026-02-13T14:29:17.972Z","id":"mx-0631c3"}
{"type":"pattern","name":"diff-command","description":"mulch diff shows expertise changes between git refs. Uses execFileSync to run git diff on .mulch/expertise/, parses unified diff output to extract added/removed JSONL records per domain. Pure functions parseExpertiseDiff and formatDiffOutput separate parsing logic from command registration for testability.","classification":"tactical","recorded_at":"2026-02-14T05:14:44.367Z","files":["src/commands/diff.ts","test/commands/diff.test.ts"],"id":"mx-f0f188"}
{"type":"failure","description":"Used greedy regex /.mulch\\/expertise\\/(.+)\\.jsonl/ to extract domain from git diff headers like 'diff --git a/.mulch/expertise/cli.jsonl b/.mulch/expertise/cli.jsonl', captured 'cli.jsonl b/.mulch/expertise/cli' instead of 'cli'.","resolution":"Changed to non-greedy pattern /\\.mulch\\/expertise\\/([^/]+)\\.jsonl/ using [^/]+ to match only characters that aren't forward slashes, correctly extracting just the domain name.","classification":"observational","recorded_at":"2026-02-14T05:14:50.432Z","id":"mx-ee5e54"}
{"type":"pattern","name":"status-json-health","description":"mulch status --json includes domain health metrics: governance_utilization (percentage of max_entries), stale_count (using isRecordStale with shelf_life config), type_distribution (counts per RecordType), classification_distribution (counts per Classification), oldest_timestamp, newest_timestamp. Calculated via calculateDomainHealth in expertise.ts","classification":"foundational","recorded_at":"2026-02-14T05:16:04.867Z","files":["src/commands/status.ts","src/utils/expertise.ts"],"id":"mx-387865"}
{"type":"pattern","name":"confirmation-prompts","description":"Use createInterface from node:readline for interactive confirmation prompts. Implement confirmAction helper that returns Promise<boolean>, check y/yes responses. Always provide --yes flag to skip confirmation in non-interactive/CI contexts.","classification":"tactical","recorded_at":"2026-02-14T05:44:21.774Z","files":["src/commands/compact.ts"],"id":"mx-17d0cf"}
{"type":"pattern","name":"dry-run-flag","description":"For commands that perform bulk/destructive operations, add --dry-run flag to preview what would happen without writing. Show detailed summary of planned changes. In JSON mode, output 'action: dry-run' with structured data about what would be modified.","classification":"tactical","recorded_at":"2026-02-14T05:44:28.771Z","files":["src/commands/compact.ts"],"id":"mx-4713b7"}
{"type":"pattern","name":"batch-operation-guardrails","description":"For auto/batch operations, add guardrails: (1) minimum threshold (--min-group), (2) maximum limit per run (--max-records), (3) summary before execution, (4) confirmation prompt unless --yes. Prevents over-aggressive automation from destroying data/granularity.","classification":"tactical","recorded_at":"2026-02-14T05:44:34.342Z","files":["src/commands/compact.ts"],"id":"mx-8761b0"}
{"type":"failure","description":"Node v25.3.0 intercepts piped stdin (echo '...' | node script.js) and evaluates it as JavaScript instead of passing it to the process. Breaks: (1) pipe-based --stdin usage, (2) interactive confirmation prompts via pipe.","resolution":"Use file redirects (< file.json) instead of pipes, or invoke via bin link (npx mulch). Consider adding --yes flag to delete command for non-interactive use.","classification":"tactical","recorded_at":"2026-02-16T01:47:19.405Z","id":"mx-ca6219"}
{"type":"pattern","name":"domain-scoped-operations","description":"When a CLI command accepts an optional domain argument and iterates over domains, filter to the specified domain if provided. Apply domain validation before processing. Pattern: const domainsToCheck = domain ? [domain] : config.domains;","classification":"tactical","recorded_at":"2026-02-17T16:35:30.191Z","evidence":{"commit":"90f81cb"},"id":"mx-b96406"}
{"type":"pattern","name":"dry-run-preview-detail","description":"Dry-run modes should show detailed previews, not just summaries. Users need to see what will change (affected items, groups, records) to build confidence before running destructive operations. Show the same level of detail as the actual operation would display.","classification":"tactical","recorded_at":"2026-02-17T16:35:36.815Z","evidence":{"commit":"90f81cb"},"id":"mx-ccc480"}
{"type":"pattern","name":"hierarchical-grouped-output","description":"When displaying grouped data (e.g., by domain), organize output hierarchically with clear visual structure. Use bold headers for groups, indentation for hierarchy, and summary lines showing totals. Makes output easier to scan and understand at a glance.","classification":"tactical","recorded_at":"2026-02-17T16:35:42.784Z","evidence":{"commit":"90f81cb"},"id":"mx-0da345"}
{"type":"pattern","name":"doctor-details-output","description":"For non-pass checks (warn/fail), print check.details array with indentation after the status message to show per-domain information like governance thresholds and actual values","classification":"tactical","recorded_at":"2026-02-17T16:35:16.015Z","evidence":{"commit":"dd2bc6c","bead":"mulch-8w2"},"id":"mx-eef5d0"}
{"type":"pattern","name":"record-type-extensibility","description":"Record type extensibility via discriminated union: Each of 6 record types extends BaseRecord with type-specific required fields, validated via JSON schema oneOf. Adding new type requires: (1) TypeScript interface in record.ts, (2) schema oneOf variant in record-schema.ts, (3) switch cases in generateRecordId/findDuplicate (expertise.ts), (4) formatter functions in format.ts, (5) CLI options in edit.ts, (6) type choices in search.ts. Domain health, validation, compact/prune/doctor commands are generic and need no changes.","classification":"tactical","recorded_at":"2026-02-20T19:17:38.849Z","evidence":{"bead":"mulch-0hb"},"files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/utils/expertise.ts","src/utils/format.ts","src/commands/edit.ts","src/commands/search.ts"],"id":"mx-8b3c21"}
{"type":"pattern","name":"semantic-duplicate-detection","description":"Duplicate detection uses semantic key matching: findDuplicate() in expertise.ts uses type-specific key fields to identify duplicates before append. Each type has its matching key: patternâ†’name, decisionâ†’title, conventionâ†’content, failureâ†’description, referenceâ†’name, guideâ†’name. New types must define their unique key field in a switch case to prevent duplicate records.","classification":"tactical","recorded_at":"2026-02-20T19:17:42.492Z","evidence":{"bead":"mulch-0hb"},"files":["src/utils/expertise.ts"],"id":"mx-dd0208"}
{"type":"reference","name":"type-specific-formatting","description":"Record type formatting uses dedicated type-specific formatters in format.ts: formatConventions, formatPatterns, formatFailures, formatDecisions, formatReferences, formatGuides. All called from formatDomainExpertise after filtering records by type. getRecordSummary() and compactLine() also have switch statements for compact prime output. Formatters use shared helpers: idTag(), formatRecordMeta(), formatLinks() to reduce duplication.","classification":"tactical","recorded_at":"2026-02-20T19:17:46.197Z","evidence":{"bead":"mulch-0hb"},"files":["src/utils/format.ts"],"id":"mx-d432fa"}
{"type":"pattern","name":"file-and-classification-filters","description":"filterByClassification and filterByFile in expertise.ts follow the same filterByType pattern â€” accept ExpertiseRecord[] and a string, return filtered array. filterByFile uses 'files' in r guard (PatternRecord and ReferenceRecord have files?: string[]) and does case-insensitive substring match. --classification and --file options added to both search and query commands.","classification":"tactical","recorded_at":"2026-02-20T19:13:49.100Z","evidence":{"bead":"mulch-jld"},"id":"mx-171985"}
{"type":"pattern","name":"outcome-metadata","description":"Outcome type (status: 'success'|'failure', duration?, test_results?, agent?) added as optional field on BaseRecord. Schema uses $ref '#/definitions/outcome'. CLI options: --outcome-status, --outcome-duration, --outcome-test-results, --outcome-agent. Filtering via --outcome-status in search.","classification":"tactical","recorded_at":"2026-02-20T19:44:41.409Z","files":["src/schemas/record.ts","src/schemas/record-schema.ts","src/commands/record.ts","src/commands/edit.ts","src/commands/search.ts","src/utils/format.ts"],"id":"mx-2d3089"}
{"type":"pattern","name":"scoring-module","description":"src/utils/scoring.ts exports Outcome, ScoredRecord, and scoring functions: getSuccessCount, getFailureCount, getTotalApplications, getSuccessRate, computeConfirmationScore, applyConfirmationBoost, sortByConfirmationScore. Partial outcomes count as 0.5 in rate and score. applyConfirmationBoost multiplies baseScore by (1 + factor * confirmationScore). sortByConfirmationScore returns a new array (does not mutate input).","classification":"tactical","recorded_at":"2026-02-20T19:42:27.699Z","evidence":{"bead":"mulch-y6q"},"id":"mx-26e590"}
{"type":"convention","content":"budget-scoring integration: widened DomainRecords.records from ExpertiseRecord[] to ScoredRecord[]; recordSortKey returns 4-tuple [typeIdx, classIdx, -confirmationScore, -time]. No breaking change since outcomes is optional.","classification":"tactical","recorded_at":"2026-02-20T19:53:04.424Z","evidence":{"commit":"50cb1bf"},"id":"mx-c081d5"}
{"type":"pattern","name":"search-sort-by-score","description":"search command --sort-by-score: sortByConfirmationScore from scoring.ts integrated by casting ExpertiseRecord[] as ScoredRecord[] (valid since outcomes is optional) and applying after query/filter pipeline. Both JSON and non-JSON code paths apply the sort.","classification":"tactical","recorded_at":"2026-02-20T20:00:33.983Z","evidence":{"commit":"e15d4f3"},"id":"mx-48b592"}
{"type":"pattern","name":"programmatic-api","description":"src/api.ts exports recordExpertise, searchExpertise, queryDomain, editRecord as high-level programmatic wrappers over the expertise utilities. All four accept an optional cwd for path resolution, use withFileLock for writes, and throw descriptive errors on invalid domain/id.","classification":"tactical","recorded_at":"2026-02-20T21:48:21.423Z","evidence":{"commit":"e5092d0"},"files":["src/api.ts","src/index.ts","test/api.test.ts"],"id":"mx-b42722"}
{"type":"pattern","name":"branding-palette","description":"Each tool defines src/utils/palette.ts with brand (tool-specific color), accent (amber for IDs), muted (stone gray), icons (âœ“/!/âœ—/âˆ’/>/x set D), setQuiet/isQuiet, printSuccess/printError/printWarning. Mulch brand: chalk.rgb(139,90,43). Shared: accent=chalk.rgb(255,183,77), muted=chalk.rgb(120,120,110). Import palette in commands instead of raw chalk.green/red.","classification":"tactical","recorded_at":"2026-02-24T21:24:16.960Z","evidence":{"commit":"b766ec0"},"outcomes":[{"status":"success","agent":"branding-builder"}],"id":"mx-9c3077"}
{"type":"convention","content":"cli.ts exports VERSION constant and handles --version --json early (before Commander), applies --quiet/-q early via setQuiet(). .version(VERSION, '-v, --version', 'Print version') uses short form -v. addHelpCommand(false) suppresses the default help subcommand.","classification":"tactical","recorded_at":"2026-02-24T21:24:22.702Z","evidence":{"commit":"b766ec0"},"outcomes":[{"status":"success","agent":"branding-builder"}],"id":"mx-5e6845"}
{"type":"pattern","name":"help-style-A","description":"Style A help screen via program.configureHelp({ formatHelp(cmd, helper) }): (1) header line with brand.bold(name) + muted version + tagline, (2) Usage line, (3) Commands: chalk.green(name) + chalk.dim(args) + plain-text padding to col 20, (4) Options: chalk.dim(flags) + padding to col 20, (5) footer 'Run dim(alias) <command> --help'. Padding uses rawLen (plain text), not ANSI length.","classification":"tactical","recorded_at":"2026-02-24T21:24:32.487Z","evidence":{"commit":"b766ec0"},"outcomes":[{"status":"success","agent":"branding-builder"}],"id":"mx-80bb31"}
{"type":"convention","content":"cli.ts exports VERSION constant and handles --version --json early (before Commander), applies --quiet/-q early via setQuiet(). Use .version(VERSION, '-v, --version', 'Print version') for short -v flag. addHelpCommand(false) suppresses default help subcommand.","classification":"tactical","recorded_at":"2026-02-24T21:25:07.961Z","evidence":{"commit":"b766ec0"},"outcomes":[{"status":"success","agent":"branding-builder"}],"id":"mx-a36a41"}
{"type":"pattern","name":"upgrade-command","description":"mulch upgrade checks npm registry via getLatestVersion(), compares with VERSION, optionally installs via Bun.spawnSync bun install -g @os-eco/mulch-cli@latest. Uses palette helpers for human output, outputJson for --json. --check flag reports without installing.","classification":"tactical","recorded_at":"2026-02-24T21:53:39.334Z","files":["src/commands/upgrade.ts"],"id":"mx-44a2f1"}
{"type":"pattern","name":"doctor-legacy-outcome-check","description":"checkLegacyOutcome() in doctor.ts scans raw JSONL for records with singular 'outcome' field (legacy pre-outcomes[] format). Fix migrates outcome:{...} â†’ outcomes:[{...}] via applyFixes case 'legacy-outcome', using same field extraction as readExpertiseFile normalization. Check inserted before schema-validation so --fix migrates before schema check removes the record. biome requires dot notation (raw.outcome) and undefined assignment instead of delete.","classification":"tactical","recorded_at":"2026-02-25T15:20:31.834Z","outcomes":[{"status":"success","agent":"doctor-outcome-builder"}],"id":"mx-aeb044"}
{"type":"pattern","name":"validate-legacy-outcome-warning","description":"validate command detects records with legacy 'outcome' (singular) field and emits a warning (not an error) since readExpertiseFile already normalizes at read time. JSON output includes totalWarnings and warnings[] alongside totalErrors and errors[]. Text output prints yellow warning lines and includes warning count in summary. Legacy records skip Ajv schema validation (which would fail due to additionalProperties:false).","classification":"tactical","recorded_at":"2026-02-25T15:20:37.166Z","outcomes":[{"status":"success","agent":"doctor-outcome-builder"}],"id":"mx-c37384"}
{"type":"pattern","name":"auto-create-domain","description":"mulch record auto-creates a domain (addDomain in config.ts) when the domain doesn't exist in config, instead of failing. addDomain: validateDomainName, readConfig, push domain, writeConfig, createExpertiseFile. Called from both processStdinRecords and CLI-mode action.","classification":"tactical","recorded_at":"2026-02-25T15:20:36.974Z","outcomes":[{"status":"success","agent":"record-builder"}],"id":"mx-cef2b9"}
{"type":"pattern","name":"validation-type-hints","description":"RECORD_TYPE_REQUIREMENTS map in record.ts maps record type to required-fields string. Appended as '. Hint: <hint>' to AJV validation errors in processStdinRecords and CLI-mode schema validation fallback. No hint added when record has no type field.","classification":"tactical","recorded_at":"2026-02-25T15:20:39.212Z","outcomes":[{"status":"success","agent":"record-builder"}],"id":"mx-576d71"}
{"type":"pattern","name":"domain-not-found-hints","description":"When a domain arg is not found in text mode, print a second console.error line: 'Hint: Run `mulch add <name>` to create this domain, or check .mulch/mulch.config.yaml'. Applies to query (domain arg), search (--domain), prime (domain arg and --exclude-domain). JSON mode does not get the hint â€” text-only.","classification":"tactical","recorded_at":"2026-02-25T15:21:34.643Z","outcomes":[{"status":"success","agent":"hint-builder"}],"id":"mx-03eaf1"}
