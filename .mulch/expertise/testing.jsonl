{"type":"failure","description":"Prune boundary test was flaky — daysAgo(14) plus milliseconds of clock drift made age 14.0000001, passing the > 14 check","resolution":"Math.floor the age-in-days computation so boundary records are treated as exactly N whole days old","classification":"tactical","recorded_at":"2026-02-10T00:33:19.878Z","id":"mx-992c08"}
{"type":"convention","content":"No mocks. Tests use real filesystems — create temp dirs with mkdtemp, write real config/JSONL, assert against real file contents, clean up in afterEach.","classification":"tactical","recorded_at":"2026-02-10T19:03:06.791Z","id":"mx-53d431"}
{"type":"convention","content":"Test file location mirrors src/ structure: test/commands/ for src/commands/, test/utils/ for src/utils/. Test file name matches source file name.","classification":"tactical","recorded_at":"2026-02-10T19:03:08.010Z","id":"mx-40a586"}
{"type":"failure","description":"Used process.exit(1) in command handler. Tests hung or produced garbled output because exit killed the Vitest process.","resolution":"Use process.exitCode = 1 instead. Lets the event loop drain and Vitest clean up.","classification":"tactical","recorded_at":"2026-02-10T19:03:18.137Z","id":"mx-c1d2d0"}
{"type":"failure","description":"Ajv schema had required and properties but no type: 'object'. Validation worked in dev but Ajv strict mode threw 'unknown keyword' in tests.","resolution":"Always include type: 'object' alongside required and properties in every JSON schema definition/oneOf branch.","classification":"tactical","recorded_at":"2026-02-10T19:03:19.964Z","id":"mx-a22e75"}
{"type":"pattern","name":"indirect-function-testing","description":"Test unexported functions indirectly via observable outcomes. When internal functions like findCandidates are not exported, verify their behavior by testing the file system state, data structures, and other observable effects rather than calling them directly.","classification":"tactical","recorded_at":"2026-02-17T16:55:47.409Z","evidence":{"commit":"b74698c"},"id":"mx-5f95a9"}
{"type":"pattern","name":"domain-isolation-testing","description":"Verify domain filtering by testing record isolation across multiple domains. Create expertise files for different domains, add records to each, then verify that records remain segregated and that type-based grouping works correctly within each domain. This validates the foundation for domain-filtered operations.","classification":"tactical","recorded_at":"2026-02-17T16:55:54.875Z","evidence":{"commit":"b74698c"},"id":"mx-d07ba3"}
{"type":"pattern","name":"scored-record-test-data","description":"To test scoring sort in search tests: write ScoredRecord JSON directly to JSONL via appendFile (bypassing appendRecord type constraint). Use a separate domain (api) to avoid pre-existing records from beforeEach contaminating count assertions.","classification":"tactical","recorded_at":"2026-02-20T20:00:39.427Z","evidence":{"commit":"e15d4f3"},"id":"mx-122127"}
